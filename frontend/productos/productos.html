<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Suvalus - Productos</title>
  <!-- Enlazar estilos globales -->
  <link rel="stylesheet" href="styles.css">
</head>
<body class="index">

  <!-- Header -->
  <header>
    <a href="../../index.html" class="logo-link">
      <img src="../Imagenes/Logo_Suvalu.png" alt="Logo Suvalus" class="logo-image" />
    </a>
    <nav>
      <a href="../../index.html">Inicio</a>
      <a href="productos.html" class="active">Productos</a>
      <a href="../contacto/contacto.html">Contacto</a>
    </nav>
  </header>

  <!-- Products Gallery Section -->
  <section class="products-gallery">
    <h2 class="section-title">Nuestros Productos</h2>

    <!-- Search and Filters -->
    <div class="filters-container">
      <input type="text" id="searchInput" placeholder="Buscar productos..." aria-label="Buscar productos" />
      <button id="searchButton" aria-label="Buscar">
        üîç
      </button>
      <div class="filter-dropdown-container">
        <button id="filterToggleButton" aria-expanded="false" aria-controls="filterDropdown" aria-label="Mostrar filtros">Filtros ‚ñæ</button>
        <div id="filterDropdown" class="filter-dropdown" hidden>
          <!-- Bot√≥n de cerrar eliminado seg√∫n solicitud -->
          <label><input type="checkbox" class="category-filter" value="Pi√±atas" checked /> Pi√±atas</label>
          <label><input type="checkbox" class="category-filter" value="Bolsitas" checked /> Bolsitas</label>
          <label><input type="checkbox" class="category-filter" value="Faroles" checked /> Faroles</label>
          <label><input type="checkbox" class="category-filter" value="Accesorios" checked /> Accesorios</label>
          <label><input type="checkbox" class="category-filter" value="Centros de Mesa" checked /> Centros de Mesa</label>
          <label><input type="checkbox" class="category-filter" value="Photobooth" checked /> Photobooth</label>
          <label><input type="checkbox" class="category-filter" value="Otros" checked /> Otros</label>
        </div>
      </div>
    </div>

    <div class="gallery" id="gallery">
      <!-- Product cards will be dynamically inserted here -->
    </div>
  </section>

  <!-- Footer -->
  <footer>
    <p>¬© 2025 Suvalus. Todos los derechos reservados.</p>
  </footer>

    <script>
      let productsData = [];
  
      // Fetch products JSON and dynamically create product cards
      fetch('productos.json')
        .then(response => {
          if (!response.ok) {
            throw new Error('Error al cargar el archivo JSON');
          }
          return response.json();
        })
        .then(products => {
          productsData = products;
          renderProducts(productsData);
        })
        .catch(error => {
          console.error('Error:', error);
        });
  
      const gallery = document.getElementById('gallery');
      const searchInput = document.getElementById('searchInput');
      const searchButton = document.getElementById('searchButton');
      const categoryFilters = document.querySelectorAll('.category-filter');
      const filterToggleButton = document.getElementById('filterToggleButton');
      const filterDropdown = document.getElementById('filterDropdown');
  
      function renderProducts(products) {
        gallery.innerHTML = '';
        products.forEach(product => {
          const card = document.createElement('div');
          card.className = 'card';
  
          const img = document.createElement('img');
          img.src = product.imagen;
          img.alt = product.nombre;
  
          const cardContent = document.createElement('div');
          cardContent.className = 'card-content';
  
          const h3 = document.createElement('h3');
          h3.textContent = product.nombre;
  
          const p = document.createElement('p');
          p.textContent = product.descripcion;
  
          const button = document.createElement('button');
          button.className = 'btn';
          button.textContent = 'Ver Detalles';
  
          cardContent.appendChild(h3);
          cardContent.appendChild(p);
          cardContent.appendChild(button);
  
          card.appendChild(img);
          card.appendChild(cardContent);
  
          gallery.appendChild(card);
        });
      }
  
      function filterProducts() {
        const searchText = searchInput.value.toLowerCase();
        const selectedCategories = Array.from(categoryFilters)
          .filter(checkbox => checkbox.checked)
          .map(checkbox => checkbox.value);
  
        const filtered = productsData.filter(product => {
          const matchesCategory = selectedCategories.includes(product.categoria);
          const matchesSearch = product.nombre.toLowerCase().includes(searchText) || product.descripcion.toLowerCase().includes(searchText);
          return matchesCategory && matchesSearch;
        });
  
        renderProducts(filtered);
      }
  
      searchInput.addEventListener('input', filterProducts);
      searchButton.addEventListener('click', filterProducts);
      categoryFilters.forEach(checkbox => checkbox.addEventListener('change', filterProducts));
  
      // Asegurar que el dropdown est√© oculto al cargar la p√°gina
      document.addEventListener('DOMContentLoaded', () => {
        filterDropdown.style.display = 'none';
        filterToggleButton.setAttribute('aria-expanded', 'false');

        // Leer par√°metro de categor√≠a de la URL
        const urlParams = new URLSearchParams(window.location.search);
        const categoriaParam = urlParams.get('categoria');
        if (categoriaParam) {
          // Marcar el checkbox correspondiente
          categoryFilters.forEach(checkbox => {
            checkbox.checked = checkbox.value === categoriaParam;
          });
          // Aplicar filtro autom√°ticamente sin necesidad de interacci√≥n adicional
          filterProducts();
          // Mostrar el dropdown para que el usuario vea el filtro activo
          filterDropdown.style.display = 'flex';
          filterToggleButton.setAttribute('aria-expanded', 'true');
        }
      });

      filterToggleButton.addEventListener('click', () => {
        const isDisplayed = filterDropdown.style.display === 'flex';
        console.log('Toggle button clicked. Dropdown displayed:', isDisplayed);
        if (!isDisplayed) {
          filterDropdown.style.display = 'flex';
          filterToggleButton.setAttribute('aria-expanded', 'true');
          console.log('Dropdown opened');
        } else {
          filterDropdown.style.display = 'none';
          filterToggleButton.setAttribute('aria-expanded', 'false');
          console.log('Dropdown closed');
        }
      });

      // Usar event delegation para el bot√≥n cerrar filtros
      /*document.addEventListener('click', (event) => {
        if (event.target && event.target.id === 'closeFilterDropdown') {
          console.log('Close button clicked');
          event.stopPropagation();
          filterDropdown.style.display = 'none';
          filterToggleButton.setAttribute('aria-expanded', 'false');
        }
      });*/

      /* // Cerrar el dropdown si se hace clic fuera
      document.addEventListener('click', (event) => {
        if (
          !filterToggleButton.contains(event.target) &&
          !filterDropdown.contains(event.target) &&
          event.target.id !== 'closeFilterDropdown'
        ) {
          console.log('Clicked outside dropdown, closing');
          filterDropdown.setAttribute('hidden', '');
          filterToggleButton.setAttribute('aria-expanded', 'false');
        }
      }); */
    </script>

</body>
</html>
